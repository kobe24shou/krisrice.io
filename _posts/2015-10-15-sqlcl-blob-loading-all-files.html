---
layout: post
title: SQLCL - Blob loading ALL the files
date: '2015-10-15T06:39:00.000-07:00'
author: Kris Rice
tags:
- sqlcl
modified_time: '2016-06-10T13:03:58.800-07:00'
thumbnail: http://1.bp.blogspot.com/-xp51k-6GY8E/Vh8GZ_58lII/AAAAAAAABII/IZYm33rePsk/s72-c/Screen%2BShot%2B2015-10-14%2Bat%2B21.49.47.png
blogger_id: tag:blogger.com,1999:blog-37621059.post-1868629293653317824
blogger_orig_url: http://krisrice.blogspot.com/2015/10/sqlcl-blob-loading-all-files.html
---

<br />The github repo for all the things the DB Tools team does will be posted here <a href="https://github.com/oracle/Oracle_DB_Tools">https://github.com/oracle/Oracle_DB_Tools</a> This will include sqlcl , sqldev, modeler, ords , and who knows what other things we have up our sleeves to post. &nbsp;This repo is going to be made up of &nbsp;examples and getting started things like a new extention for sqldev, custom transformation for modeler, ords integration with handsontable, or sqlcl scripting.<br /><br /><br />Now onto more BLOB loading.<br /><br />I'm slowly building out a helper.js which is now posted and I'll continue to update it on github here:&nbsp;<a href="https://github.com/oracle/Oracle_DB_Tools/tree/master/sqlcl/lib">https://github.com/oracle/Oracle_DB_Tools/tree/master/sqlcl/lib</a><br /><br />There's a new function in there to exec host commands and capture the stdout, stderr, and return code of the command. &nbsp;Now coupling that with the BLOB loading and you can load an entire directory of files into a table with a small amount of javascript.<br /><br /><br /><br /><br />New helper function<br /><br /><pre class="brush:javascript;">/*<br />*  Runs the passed in command and returns an Object with<br />*   .rc      - the return code<br />*   .stdout  - STDOUT<br />*   .stderr  - STDERR<br />*<br />*/<br />helpers.exec=function(cmd){<br />    var RunTime  = Java.type("java.lang.Runtime");<br />    var Scanner  = Java.type("java.util.Scanner");<br />    var p = RunTime.getRuntime().exec(cmd);<br /><br />    var ret={};<br />        s = new Scanner(p.getInputStream()).useDelimiter("\\A");<br />        ret.stdout = s.hasNext() ? s.next().trim() : "";<br />        s = new Scanner(p.getErrorStream()).useDelimiter("\\A");<br />        ret.stderr = s.hasNext() ? s.next().trim() : "";<br /><br />        p.waitFor();<br />        ret.rc = p.exitValue();<br />      p.destroy();<br />    return ret;<br />}<br /></pre><br /><br />Putting it together with the BLOB loading example<br /><br /><pre class="brush:javascript;">load('https://raw.githubusercontent.com/oracle/Oracle_DB_Tools/master/sqlcl/lib/helpers.js');<br /><br />/* Clean out the table just to prove it's not a baked demo */<br />sqlcl.setStmt("truncate table k");<br />sqlcl.run();<br /><br />/* File name */<br />var files= helpers.exec('find . -maxdepth 1 -type f ').stdout.split('\n');<br /><br />/* bind map for reuse */<br />var binds = helpers.getBindMap();<br /><br />for(f in files ) {<br />   //  ctx.write("Loading : " + files[f] + "\n");<br />  /* load the blob */<br />  blob = helpers.getBlobFromFile(files[f]);<br /><br />  /* assign the binds */<br />  binds.put("path",files[f]);<br />  binds.put("b",blob);<br /><br /> /* Just do it */<br />  var ret = util.execute("insert into k(path,blob_content,when) values(:path , :b, sysdate)",binds);<br />}<br /><br />/* print the results to see if it worked */<br />sqlcl.setStmt("select path,dbms_lob.getlength(blob_content) from k order by when desc;");<br />sqlcl.run();<br /></pre><br /><br /><br />Removing the truncate and select at the end, loading the entire directory of <u>client side</u> files is 7 lines of javascript.<br /><br /><br /><div class="separator" style="clear: both; text-align: left;"><a href="http://1.bp.blogspot.com/-xp51k-6GY8E/Vh8GZ_58lII/AAAAAAAABII/IZYm33rePsk/s1600/Screen%2BShot%2B2015-10-14%2Bat%2B21.49.47.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="640" src="http://1.bp.blogspot.com/-xp51k-6GY8E/Vh8GZ_58lII/AAAAAAAABII/IZYm33rePsk/s640/Screen%2BShot%2B2015-10-14%2Bat%2B21.49.47.png" width="378" /></a></div><br />