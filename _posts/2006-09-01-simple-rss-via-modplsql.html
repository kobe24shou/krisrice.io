---
layout: post
title: Simple RSS via mod_plsql
date: '2006-09-01T16:15:00.000-07:00'
author: Kris Rice
tags:
- Pl/SQL
modified_time: '2006-11-15T15:33:12.112-08:00'
blogger_id: tag:blogger.com,1999:blog-37621059.post-116363336757419096
blogger_orig_url: http://krisrice.blogspot.com/2006/09/simple-rss-via-modplsql.html
---

<p>If anyone hasn't heard there's a <a href="http://sqldeveloper.oracle.com">website</a> to submit <a href="http://sueharper.blogspot.com/2006/08/sql-developer-exchange-is-launched.html">various</a> things to share with SQL Developer users and the development team.  This site was built using <a href="http://otn.oracle.com/apex">APEX</a>.  The RSS feed is just plain plsql.  Here's how simple can be to get an rss feed from the database.<br /><br /><p>Here's all I did for the <a href="http://htmldb.oracle.com/pls/otn/dbtools.recent_tips_rss">feed</a> of the exchange for the tip that have been submitted.<br /><br /><pre><br />create or replace procedure RECENT_TIPS_RSS<br />is<br />begin<br />rss(p_title =>'SQL Developer Recent Tips and Tricks',<br />    p_base_link =>'http://www.oracle.com/technology/products/database/sql_developer/index.html',<br />    p_base_descr =>'This is a list of recently published Tips and Tricks for Oracle SQL Developer',<br />    p_item_link =>'http://htmldb.oracle.com/pls/otn/f?p=42626:54:::::P54_ID:',<br />    p_sql =>'select id,name,created_by,created_on,description from (select * from applications where status=''APPROVED''    order by created_on desc ) where rownum < 10 ');<br />end;<br /></pre><br /><br /><br /><br /><br /><p>This uses a simple procedure I made which takes in the sql to be run.  Most of the parameters are obvious however the item link and the sequence of the select list are the 2 that need to be explained.<br /><br /><p>The select list is expected to be in this order id , title , author , date , optionally a link to the item.  Then the rest of the columns are all dumped into the description.  The link is optional because in this tip example there's a p_item_link passed in.  When this is passed in the link to the item is this link with the id concatted to the end.  So in this feed an item link would be http://htmldb.oracle.com/pls/otn/f?p=42626:54:::::P54_ID:221 where the 221 is the id.  If the p_item_link is not passed in, then column 5 is expected to be the link.  This should be obvious that this is used when the links go to different urls.<br /><br /><p>Hopefully, someone find this useful. I also have this as an atom feed if people want that.<br /><br /><pre><br />procedure rss(p_title varchar2,<br />              p_base_link varchar2,<br />              p_base_descr varchar2,<br />              p_item_link varchar2,<br />              p_sql varchar2,<br />              p_debug varchar2 default 'N')<br />AS<br />  l_descTbl dbms_sql.desc_tab2;<br />  l_colCnt NUMBER;<br />  l_cursor NUMBER;<br />  l_id varchar2(4000);<br />  l_title varchar2(4000);<br />  l_author varchar2(4000);<br />  l_link varchar2(4000);<br />  l_date date;<br />  l_ret number;<br />  l_col_val varchar2(32767);<br />  l_start number := 5;<br />  l_stub varchar2(2000) := ' ';<br />  i number;<br />  k number := 0;<br /><br />  // format an oracle date<br />  function formatDate(l_d date) return varchar2 as<br />     begin<br />        return to_char(l_d,'RRRR-MM-DD')||'T'||to_char(l_d,'HH24:MI:SS')||'Z';<br />     end;<br /> begin<br />   owa_util.mime_header('text/xml', FALSE );<br />   htp.p('Cache-Control: no-cache');<br />   htp.p('Pragma: no-cache');<br />   owa_util.http_header_close;<br />   htp.p('&lt;?xml version="1.0"?>');<br />   htp.p('&lt;rss version="2.0">');<br /><br />-- debug print the sql as a comment<br />   if ( p_debug = 'Y' ) then<br />      htp.p('&lt;!-- '||p_sql ||'-->');<br />   end if;<br /><br />-- print the header info<br />   htp.p('&lt;channel>');<br />   htp.p('&lt;title>'||p_title||'&lt;/title>');<br />   htp.p('&lt;link>'||p_base_link||'&lt;/link>');<br />   htp.p('&lt;description>'||p_base_descr||'&lt;/description>');<br />   htp.p('&lt;language>enus&lt;/language>');<br />   htp.p('&lt;lastBuildDate>Tue, 10 Jun 2003 09:41:01 GMT&lt;/lastBuildDate>');<br />   htp.p('&lt;docs>http://blogs.law.harvard.edu/tech/rss&lt;/docs>');<br />   htp.p('&lt;generator>mod_plsql rss&lt;/generator>');<br />   htp.p('&lt;managingEditor>kris.rice@oracle.com&lt;/managingEditor>');<br />   htp.p('&lt;webMaster>kris.rice@oracle.com&lt;/webMaster>');<br /><br />-- open the cursor and start looping<br />   l_cursor := dbms_sql.open_cursor;<br />   dbms_sql.parse(l_cursor, p_sql||l_stub, dbms_sql.native);<br />   dbms_sql.describe_columns2( l_cursor,l_colCnt,l_descTbl );<br />   l_ret := dbms_sql.execute(l_cursor);<br />   -- define the columns<br />   for i in 1.. l_colcnt loop<br />      if ( i != 4 ) then<br />         dbms_sql.define_column(l_cursor, i, l_col_val, 32767 );<br />      else<br />         dbms_sql.define_column(l_cursor, i, l_date);<br />      end if;<br />   end loop;<br />-- <br />-- Main cursor loop<br />-- <br />loop<br />   if dbms_sql.fetch_rows(l_cursor) = 0 then<br />      exit;<br />   end if;<br />--<br />-- Expected sequence of columns is id , title , author , date , optionally a link to the item<br />--<br />   dbms_sql.column_value(l_cursor, 1, l_id);<br />   dbms_sql.column_value(l_cursor, 2, l_title);<br />   dbms_sql.column_value(l_cursor, 3, l_author);<br />   dbms_sql.column_value(l_cursor, 4, l_date);<br />   htp.p('&lt;item>');<br />   htp.p('&lt;title>&lt;![CDATA['||l_title||']]> &lt;/title>');<br />   htp.p('&lt;author>&lt;![CDATA['||l_author||']]> &lt;/author>');<br />   htp.p('&lt;pubDate>&lt;![CDATA['||formatDate(l_date)||']]> &lt;/pubDate>');<br /><br />--<br />-- If p_item_link was set for the item print it and tack on the id to the end<br />-- Otherwise print colum 5 as the link<br />-- <br />   if ( p_item_link is not null ) then<br />      htp.p('&lt;link>'||p_item_link||l_id||'&lt;/link>');<br />   else<br />      dbms_sql.column_value(l_cursor, 5, l_link);<br />      htp.p('&lt;link>'||l_link||'&lt;/link>');<br />      l_start := l_start +1;<br />   end if;<br /><br />--<br />-- Now loop the rest of the columns in the select list and dump them into the description<br />--<br />   htp.p('&lt;description>&lt;![CDATA[');<br />   for i in l_start.. l_colcnt loop<br />      -- Dump the cols into the description<br />      dbms_sql.column_value(l_cursor, i, l_col_val);<br />      htp.p(lower(l_desctbl(i).col_name) ||':'||l_col_val||'&lt;br />'); <br />   end loop; -- col loop<br /><br /><br />   htp.p(']]> &lt;/description>');<br />   htp.p('&lt;guid>');<br />   htp.p(l_id);<br />   htp.p('&lt;/guid>');<br />   htp.p('&lt;/item>');<br />   end loop; -- cursor loop<br /><br />   htp.p('&lt;/channel>');<br />   htp.p('&lt;/rss>');<br />   exception when others then<br />      htp.p(SQLERRM);<br />end rss;<br /></pre>