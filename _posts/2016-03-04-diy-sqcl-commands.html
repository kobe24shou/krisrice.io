---
layout: post
title: DIY SQCL Commands
date: '2016-03-04T10:12:00.000-08:00'
author: Kris Rice
tags:
- sqlcl
modified_time: '2016-06-10T13:03:58.829-07:00'
thumbnail: https://2.bp.blogspot.com/-93SP0OsshDE/VtnP5kpMCJI/AAAAAAAABKU/ZFxgNtlP3sI/s72-c/sql-command-line-200-diy.png
blogger_id: tag:blogger.com,1999:blog-37621059.post-43422589290605263
blogger_orig_url: http://krisrice.blogspot.com/2016/03/diy-sqcl-commands.html
---

<a href="http://2.bp.blogspot.com/-93SP0OsshDE/VtnP5kpMCJI/AAAAAAAABKU/ZFxgNtlP3sI/s1600/sql-command-line-200-diy.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="https://2.bp.blogspot.com/-93SP0OsshDE/VtnP5kpMCJI/AAAAAAAABKU/ZFxgNtlP3sI/s400/sql-command-line-200-diy.png" /></a><br /><br />As mentioned once or twice or 100 times, sqlcl exposes javascript scripting with nashorn to make things very scriptable. &nbsp;To learn more on Nashorn itself there's a lot of great write ups such as&nbsp;http://www.oracle.com/technetwork/articles/java/jf14-nashorn-2126515.html &nbsp;So far, the scripting examples have been along the lines of conditional or looping of existing sqlcl commands.<br /><br />Here's an example of creating a brand new command only from javascript. &nbsp;This is a pretty simple one that for ALL command will snapshot the start time and print the elapsed time. &nbsp;It also adds the new command "kris". <br /><br />Just to show this is really nothing that new to sqlcl, <a href="http://krisrice.blogspot.com/2006/11/getting-started-with-extension.html">here's a blog post</a> from 2006 about how to make a Java based CommandListener in SQL Developer. This hasn't changed since then.<br /><br />This all adds up to if we forget to add some feature, you want to override a command, perform something before or after commands, it's very simple to DIY your sqlcl.<br /><br /><br /><br /><a href="http://1.bp.blogspot.com/-mQxEwQ1layk/VtnMUOexuLI/AAAAAAAABKI/GEUtsZyrjW8/s1600/diy_sqlcl.gif" imageanchor="1"><img border="0" src="https://1.bp.blogspot.com/-mQxEwQ1layk/VtnMUOexuLI/AAAAAAAABKI/GEUtsZyrjW8/s1600/diy_sqlcl.gif" /></a><br /><br /><br /><br /><pre class="brush: js;">// SQLCL's Command Registry<br />var CommandRegistry = Java.type("oracle.dbtools.raptor.newscriptrunner.CommandRegistry");<br /><br />// CommandListener for creating any new command<br />var CommandListener =  Java.type("oracle.dbtools.raptor.newscriptrunner.CommandListener")<br /><br />// Broke the .js out from the Java.extend to be easier to read<br />var cmd = {};<br /><br />// Called to attempt to handle any command<br />cmd.handle = function (conn,ctx,cmd) {<br />   // Check that the command is what we want to handle<br />   if ( cmd.getSql().indexOf("kris") == 0 ){<br />       ctx.write("Hi Kris, what up?\n");<br /><br />       // return TRUE to indicate the command was handled<br />       return true;<br />    }<br />   // return FALSE to indicate the command was not handled<br />   // and other commandListeners will be asked to handle it<br />   return false;<br />}<br /><br />// fired before ANY command<br />cmd.begin = function (conn,ctx,cmd) {<br />   var start = new Date();<br /><br />   // stash something for later like the start date<br />   ctx.putProperty("cmd.start",start);<br />}<br /><br />// fired after ANY Command<br />cmd.end = function (conn,ctx,cmd) {<br />   var end = new Date().getTime();<br />   var start = ctx.getProperty("cmd.start");<br />   if ( start ) {<br />      start = start.getTime();<br />      // print out elapsed time of all commands<br />      ctx.write("Elapsed Time:" + (end - start) + "\n");<br />   }<br />}<br /><br />// Actual Extend of the Java CommandListener<br /><br />var MyCmd2 = Java.extend(CommandListener, {<br />        handleEvent: cmd.handle ,<br />        beginEvent:  cmd.begin  ,<br />        endEvent:    cmd.end<br />});<br /><br />// Registering the new Command<br />CommandRegistry.addForAllStmtsListener(MyCmd2.class);<br /></pre>