---
layout: post
title: 'SDSQL - Pre and Post Commands '
date: '2014-12-16T10:59:00.000-08:00'
author: Kris Rice
tags:
- sdsql
- sqlcl
modified_time: '2016-06-10T13:03:58.857-07:00'
blogger_id: tag:blogger.com,1999:blog-37621059.post-8073362701522441303
blogger_orig_url: http://krisrice.blogspot.com/2014/12/sdsql-pre-and-post-commands.html
---

&nbsp; This is in the process of evolving but should be enough for anyone to give it a whirl. &nbsp;The idea is that for any given statement you may want to run something before and possible after. <br /><br />&nbsp; Here's a trivial example. &nbsp;I'm issuing 2 statements 1) a drop table and 2) creating a table of select * from v$mystat before each command. &nbsp;Then after I'm doing sql that shows me the changes from that point to now.<br /><br /><pre class="brush: sql;">SQL&gt; select count(1) from emp;<br /><br />Table MY_STATS dropped.<br /><br /><br />Table MY_STATS created.<br /><br />  COUNT(1)<br />----------<br />        14<br /><br />NAME                                                                  DELTA<br />---------------------------------------------------------------- ----------<br />logical read bytes from cache                                       1859584<br />session pga memory                                                  1507328<br />session uga memory                                                  1035504<br />KTFB alloc space (block)                                              65536<br />cell physical IO interconnect bytes                                   32768<br />physical write total bytes                                            24576<br />physical write bytes                                                  24576<br />redo size                                                             16200<br />.....<br /></pre><br /><br />This is on the same connection you are executing on so whatever is being done will show in the stats as well.  One thing still being worked on is the ability to clone and pass some context to another connect and have these pre and post things done on that connection keeping the main connection free of that noise.<br /><br />The way to do this is the introduction of 2 new set commands.  The names should be a clue as to which is which : set precommand and set postcommand.  They can hold 1 or N commands to be run.<br /><br /><pre class="brush: sql;">set precommand drop table my_stats; create table my_stats as select * from v$mystat;<br />set postcommand select s.name, ( m2.value - m.value ) delta from my_stats m, v$mystat m2, V$STATNAME s where m.STATISTIC#   = m2.STATISTIC# and m.STATISTIC#    = s.STATISTIC# and m.value != m2.value order  by 2 desc;<br /><br />select count(1) from user_objects where object_name like 'E%';<br />~                                                                 <br /></pre><br />The current downside of this method is that it needs to be all on one line. &nbsp;So, if there's multiple commands to be run it's kinda ugly. &nbsp;Like in this precommand where I drop and create a table. &nbsp;The great thing about this is that the command to be run could be @mypre.sql<br /><br />This allows me to better format the sql and make it much much easier to read and maintain.<br /><br /><pre class="brush:shell;">└─&gt;cat pre.sql <br />drop table my_stats;<br />create table my_stats as select * from v$mystat;<br /><br />└─&gt;cat post.sql <br />select s.name, ( m2.value - m.value ) delta <br />  from my_stats m, v$mystat m2, V$STATNAME s <br />  where m.STATISTIC#   = m2.STATISTIC# <br />    and m.STATISTIC#    = s.STATISTIC# <br />    and m.value != m2.value order  by 2 desc;<br /><br /></pre><br />Then the sql set command look just like expected.<br /><br /><pre class="brush:sql;">set precommand @pre.sql<br />set postcommand @post.sql<br /></pre><br /><br /><br />Now if you want to mess with people throw something like this in their login.sql when they aren't looking<br /><br /><pre>SQL> set postcommand select 'Better go tune that before Joel sees it' MOTD  from dual;<br /><br /><br />Then on every command they will get that message.<br /><br />SQL> select 1 from dual;<br /><br /><br />         1<br />----------<br />         1<br /><br />MOTD                                 <br />---------------------------------------<br />Better go tune that before Joel sees it<br /><br />SQL> <br /></pre>