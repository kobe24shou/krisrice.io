---
layout: post
title: SQLcl - Oct 13th Edition
date: '2015-10-13T15:30:00.001-07:00'
author: Kris Rice
tags:
- sqlcl
modified_time: '2016-06-10T13:03:58.815-07:00'
thumbnail: http://2.bp.blogspot.com/-BtosRN34jZU/Vh2FPu1L1_I/AAAAAAAABFw/MYgfPFgm9SQ/s72-c/Screen%2BShot%2B2015-10-13%2Bat%2B18.26.53.png
blogger_id: tag:blogger.com,1999:blog-37621059.post-3434545330695021798
blogger_orig_url: http://krisrice.blogspot.com/2015/10/sqlcl-oct-13th-edition.html
---

Another build of <a href="http://www.oracle.com/technetwork/developer-tools/sql-developer/downloads/index.html">SQLCL</a> is out. &nbsp;This one has lots of great things in it. &nbsp;There's fix in there to work with Cygwin for the unlucky people that are still on windows.<br /><br /><h4>Now the new stuff: &nbsp;SCRIPT</h4>This new command can radically change things you can do in the tool. &nbsp;The script command runs a script that can be any language that is JSR-223 enabled. &nbsp;The best list I can find is here:&nbsp;<a href="https://en.wikipedia.org/wiki/List_of_JVM_languages">https://en.wikipedia.org/wiki/List_of_JVM_languages</a>&nbsp; So you want to program sql scripting in groovy,perl,javascript,pascal,.... &nbsp;All doable now.<br /><br />Javascript is the only one built into Java by default so most example will be focused on that although I do have some Jython ones also to post. <br /><br />To run a script simple type: script &lt;script name&gt; &nbsp;If there is no file extension passed along it assume a .js &nbsp;The language is loaded based on this extension. &nbsp;If the language can't be loaded you get a message saying as much "Could not load Scripting Engine for :py" &nbsp;More on how to add the other languages later.<br /><br />Here's a simple script:<br /><br /><pre class="brush:javascript;">ctx.write("Hold my beer, I'm going to try something\n\n");<br /><br />ctx.write('hi from javascript\n');<br /><br />ctx.write('This is a count of my objects');<br />sqlcl.setStmt('select count(1) from user_objects; ');<br />sqlcl.run();<br /><br />var ps1= 'set sqlprompt "@|blue  _USER|@@@|green _CONNECT_IDENTIFIER|@@|blue üçº &gt;|@"'<br /><br />ctx.write('Now javascript will change the sqlprompt\n');<br />sqlcl.setStmt(ps1);<br />sqlcl.run();<br /><br />sqlcl.setStmt('@numbers.sql');<br /><br />sqlcl.run();<br /><br /></pre><br />This example while simple show you can run commands from inside the script that affects sqlcl itself like changing the prompt. &nbsp;The simple example is that I connected to production so a baby bottle it swapped out for beer<br /><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><a href="http://2.bp.blogspot.com/-BtosRN34jZU/Vh2FPu1L1_I/AAAAAAAABFw/MYgfPFgm9SQ/s1600/Screen%2BShot%2B2015-10-13%2Bat%2B18.26.53.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-BtosRN34jZU/Vh2FPu1L1_I/AAAAAAAABFw/MYgfPFgm9SQ/s1600/Screen%2BShot%2B2015-10-13%2Bat%2B18.26.53.png" /></a></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">There's a few globals available for use. &nbsp;There'll be more formal doc to follow</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">&nbsp; &nbsp; <b>sqlcl</b></div><div class="separator" style="clear: both; text-align: left;">&nbsp; &nbsp; &nbsp; &nbsp; Methods: &nbsp;</div><div class="separator" style="clear: both; text-align: left;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<b>setStmt</b>(&lt;String of stuff to run&gt;)</div><div class="separator" style="clear: both; text-align: left;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;This can be a single statement, an entire script of stuff, or any sqlcl command such as "@numbers.sql"</div><div class="separator" style="clear: both; text-align: left;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<b>run</b>()</div><div class="separator" style="clear: both; text-align: left;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Runs whatever is in the stmts</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">&nbsp; &nbsp;<b>ctx </b>( this has tons of methods but this is the single most important )</div><div class="separator" style="clear: both; text-align: left;">&nbsp; &nbsp; &nbsp; &nbsp;Methods:</div><div class="separator" style="clear: both; text-align: left;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<b>write</b>(&lt;String&gt;)</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"></div><div class="p1">&nbsp; &nbsp;<b>util</b> ( again tons of methods )<b>&nbsp;</b></div><div class="separator" style="clear: both; text-align: left;">&nbsp; &nbsp; &nbsp; &nbsp;Methods:</div><div class="separator" style="clear: both; text-align: left;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <b>execute</b>(&lt;string&gt;,binds)</div><div class="separator" style="clear: both; text-align: left;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;executes whatever is passed in with a boolean return for success/failure</div><div class="separator" style="clear: both; text-align: left;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <b>executeReturnOneCol</b>(&lt;string&gt;,binds)</div><div class="separator" style="clear: both; text-align: left;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;executes and returns the first row , first column</div><div class="separator" style="clear: both; text-align: left;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <b>executeReturnListofList</b>(&lt;string&gt;,binds)</div><div class="separator" style="clear: both; text-align: left;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;executes and returns an array(rows) of arrays(row). &nbsp;</div><div class="separator" style="clear: both; text-align: left;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <b>executeReturnList</b>(&lt;string&gt;,binds)</div><div class="separator" style="clear: both; text-align: left;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;execute and returns and array ( rows ) of objects ( row )</div><div class="separator" style="clear: both; text-align: left;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</div><br />Here is an example using some of these methods with the expectable output shown below.<br /><br /><br /><pre class="brush:javascript;">/* Look up a single value to use in a bind later */<br />var user = util.executeReturnOneCol('select user from dual');<br /><br />var binds = {};<br />binds.name = 'EMP';<br />binds.who = user;<br /><br />ctx.write('Using Binds:'+ binds + '\n');<br /><br />ctx.write('***************************************************************\n');<br />ctx.write('*****    SIMPLE LOOP OF LIST OF LIST                ***********\n');<br />ctx.write('***************************************************************\n');<br /><br /><br />var ret = util.executeReturnListofList('select object_name,object_type from  all_objects where object_name = :name and owner = :who ',binds);<br /><br />for (var i = 0; i &lt; ret.length; i++) {<br />    ctx.write( ret[i][1]  + "\t" + ret[i][0] + "\n");<br />}<br /><br />ctx.write('\n\n');<br /><br />ctx.write('***************************************************************\n');<br />ctx.write('*****    SIMPLE LOOP OF LIST OF NAMES WITH BINDS     **********\n');<br />ctx.write('***************************************************************\n');<br /><br /><br />ret = util.executeReturnList('select object_name,object_type from  all_objects where object_name = :name and owner = :who ',binds);<br /><br />for (i = 0; i &lt; ret.length; i++) {<br />    ctx.write( ret[i].OBJECT_TYPE  + "\t" + ret[i].OBJECT_NAME+ "\n");<br />}<br /></pre><a href="http://1.bp.blogspot.com/-SAp4x9hHNwE/Vh2Fyo7Uc0I/AAAAAAAABF4/mrE6D1pG2IY/s1600/Screen%2BShot%2B2015-10-13%2Bat%2B18.28.55.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-SAp4x9hHNwE/Vh2Fyo7Uc0I/AAAAAAAABF4/mrE6D1pG2IY/s1600/Screen%2BShot%2B2015-10-13%2Bat%2B18.28.55.png" /></a><br /><br /><br /><br /><br />