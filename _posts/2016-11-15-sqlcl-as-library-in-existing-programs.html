---
layout: post
title: SQLcl as a library in existing programs
date: '2016-11-15T07:55:00.000-08:00'
author: Kris Rice
tags:
- sqlcl
modified_time: '2016-11-30T16:14:40.363-08:00'
thumbnail: https://2.bp.blogspot.com/-uxX9cixdHGs/WCneGz7vikI/AAAAAAAABNg/g4moPLU51p4AgCScRGf2WwAoXvcchoSeACK4B/s72-c/Screen%2BShot%2B2016-11-14%2Bat%2B10.53.38.png
blogger_id: tag:blogger.com,1999:blog-37621059.post-8002586649229387579
blogger_orig_url: http://krisrice.blogspot.com/2016/11/sqlcl-as-library-in-existing-programs.html
---

I got a question over the weekend if SQLcl could be leveraged as library from inside a Jython program. This may seem like it's the same thing as adding jython to SQLcl to use instead of Javascript but it's a significant difference.  This method allows for the use of SQLcl in any existing program.  That means when the program needs to interact with the database, all the code in SQLcl that is tried and true can be leveraged.<br /><br />This is a simple example to prove it's possible. &nbsp;First the jar files need to be added to Jython's command line.<br /><br /><pre class="brush:shell;"># all files in sqlcl/lib/*<br /># adjust to your install ( unzip ) of sqlcl<br />LIB=/Users/klrice/workspace/raptor_common/sqlcl/built/lib/<br />CP=<br />for  f in $(ls $LIB/*.jar); do<br /> echo $f<br /> CP=$CP:$f<br />done<br />echo --- $CP ---<br /><br />#Start up jython <br />jython -J-cp $CP <br /><br /></pre><br />Now that the needed libraries are in the path.  It's quite easy to start using the same methods and classes that have been shown in various javascript examples. &nbsp;This example gets a connection on it's own then instantiates SQLcl for programmatic use.<br /><br /><br /><pre>#import various things<br />from java.sql import DriverManager<br />from oracle.dbtools.db import DBUtil<br />from oracle.dbtools.raptor.newscriptrunner import *<br /><br />#plain ol jdbc connection<br />conn  = DriverManager.getConnection('jdbc:oracle:thin:@//localhost:1521/orcl','klrice','klrice');<br /><br />#get a DBUtil but won't actually use it in this example<br />util  = DBUtil.getInstance(conn);<br /><br />#create sqlcl<br />sqlcl = ScriptExecutor(conn);<br /><br />#setup the context<br />ctx = ScriptRunnerContext()<br /><br />#set the context<br />sqlcl.setScriptRunnerContext(ctx)<br />ctx.setBaseConnection(conn);<br /><br />#change the format<br />sqlcl.setStmt('set sqlformat json');<br />sqlcl.run();<br /><br />#run the sql<br />sqlcl.setStmt('select * from emp');<br />sqlcl.run();<br /><br /></pre><br />The output of this is simply the json output.<br /><br /><a href="http://2.bp.blogspot.com/-uxX9cixdHGs/WCneGz7vikI/AAAAAAAABNg/g4moPLU51p4AgCScRGf2WwAoXvcchoSeACK4B/s1600/Screen%2BShot%2B2016-11-14%2Bat%2B10.53.38.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="332" src="https://2.bp.blogspot.com/-uxX9cixdHGs/WCneGz7vikI/AAAAAAAABNg/g4moPLU51p4AgCScRGf2WwAoXvcchoSeACK4B/s640/Screen%2BShot%2B2016-11-14%2Bat%2B10.53.38.png" width="640" /></a><br /><br /><br /><br /><br /><br /><br />