---
layout: post
title: New Datatype support and how to add more
date: '2006-08-31T16:15:00.000-07:00'
author: Kris Rice
tags:
- Extensions
modified_time: '2006-11-15T15:33:12.035-08:00'
blogger_id: tag:blogger.com,1999:blog-37621059.post-116363333316322314
blogger_orig_url: http://krisrice.blogspot.com/2006/08/new-datatype-support-and-how-to-add.html
---

I figured it's about time I blog something again.  <a href="http://sueharper.blogspot.com/">Sue</a> has been <a href="http://sueharper.blogspot.com/2006/08/sql-developer-reports-sneak-peak-2.html">covering</a> a <a href="http://sueharper.blogspot.com/2006/07/something-to-whet-appetite-sneak-peak.html">bunch</a> of <a href="http://sueharper.blogspot.com/2006/08/handling-snippets-sneak-peak-into-11.html">1.1</a> <a href="http://sueharper.blogspot.com/2006/08/another-peep-into-futuref4-and-filters.html">features</a> that we've been doing.  I'll cover a couple more and how they are implemented and what that means to people writing custom extension.<br /></p><p><br />The general idea is to make datatypes extensible such that anyone can write a presentation for one with very little code.  There's a new interface which is registered by the class you want to render such as this first example which is for XMLType.<br /></p><p><br />The call to register would look like this.<br /></p><br /><br /><br /><pre>CellEditingFactory.registerCellRenderer(OPAQUE.class, new XMLTypeEditor());<br /></pre><p><br />Then the class XMLTypeEditor simply implements the new interface which is pretty leaves things open enough to do anything.  There's 2 methods in it.  The first getComponent this will put in the place of the cell in the grid what ever is returned and it override the default.  For this example there's a JPanel created which is just the xml with a button.  Since the button is part of the component, it can do anything which in this case pops up a modal with more space to view the data.<br /></p><pre>The second method is called when the first returns null.  The idea behind this is that someone may not need or want to build out a Component to render but simply want to create the text representation of the data.  This will use the text returned and put it into a normal table cell.<br /></pre><pre><br /><span style="color:#7f0055;">public</span> <span style="color:#7f0055;">interface</span> ICellEditor {<br />	<span style="color:#7f0055;">public</span> <span style="color:#7f0055;">abstract</span> Component getComponent(JTable table, Object value, <span style="color:#7f0055;">int</span> row, <span style="color:#7f0055;">int</span> column);<br />	<span style="color:#7f0055;">public</span> <span style="color:#7f0055;">abstract</span> String getText(JTable table, Object value,<span style="color:#7f0055;">int</span> row, <span style="color:#7f0055;">int</span> column);<br />}<br /><br /><br /></pre><p><br /><img src="http://www.orablogs.com/krice/xml.jpg"/><br /></p><p><br />Here's the what it takes to handle XMLType<br /></p><pre><br /><span style="color:#7f0055;">public</span> <span style="color:#7f0055;">class</span> XMLTypeEditor <span style="color:#7f0055;">implements</span> ICellEditor {<br /><br /><br /><br />    <span style="color:#7f0055;">public</span> Component getComponent(<span style="color:#7f0055;">final</span> JTable table, Object value, <span style="color:#7f0055;">int</span> row, <span style="color:#7f0055;">int</span> column) {<br />        XMLType xml = <span style="color:#7f0055;">null</span>;<br />        <span style="color:#7f0055;">final</span> JPanel pnl = <span style="color:#7f0055;">new</span> JPanel(<span style="color:#7f0055;">new</span> BorderLayout());<br />        <span style="color:#3f7f5f;">// convert value to xml for convience</span><br />        <span style="color:#7f0055;">try</span> {<br />            <span style="color:#7f0055;">if</span> (value <span style="color:#7f0055;">instanceof</span> XMLType) {<br />                xml = (XMLType) value;<br />            } <span style="color:#7f0055;">else</span> <span style="color:#7f0055;">if</span> (value <span style="color:#7f0055;">instanceof</span> OPAQUE &#38;&#38; ((OPAQUE) value).getSQLTypeName().equals(<span style="color:#2a00ff;">"SYS.XMLTYPE"</span>)) {<br />                xml = XMLType.createXML((OPAQUE) value);<br />            }<br />        }<br />        <span style="color:#7f0055;">catch</span> (SQLException se) {}<br />        <span style="color:#3f7f5f;">// must not be interested</span><br />        <span style="color:#3f7f5f;">// return null and let someone else render it</span><br />        <span style="color:#7f0055;">if</span> (xml == <span style="color:#7f0055;">null</span>) {<br />            <span style="color:#7f0055;">return</span> <span style="color:#7f0055;">null</span>;<br />        }<br />        <span style="color:#7f0055;">try</span> {<br />            <span style="color:#3f7f5f;">// create the returned component</span><br />            JLabel lbl = <span style="color:#7f0055;">new</span> JLabel();<br />            <span style="color:#3f7f5f;">// set the text</span><br />            lbl.setText(xml.getStringVal());<br />            <span style="color:#3f7f5f;">// set the tooltop</span><br />            lbl.setToolTipText(xml.getStringVal());<br />            <span style="color:#3f7f5f;">// add the label to the center of the panel </span><br />            pnl.add(lbl, BorderLayout.<span style="color:#0000c0;">CENTER</span>);<br />            <span style="color:#3f7f5f;">// create the ... button</span><br />            <span style="color:#7f0055;">final</span> JButton btn = <span style="color:#7f0055;">new</span> JButton(IdeIcons.getIcon(IdeIcons.<span style="color:#0000c0;">EDIT_ICON</span>));<br />            btn.setMargin(<span style="color:#7f0055;">new</span> Insets(2, 2, 2, 2));<br />            <span style="color:#3f7f5f;">// add the button to the panel</span><br />            pnl.add(btn, BorderLayout.<span style="color:#0000c0;">EAST</span>);<br /><br />            <span style="color:#3f7f5f;">// make a final so the action listener can access the xml </span><br />            <span style="color:#7f0055;">final</span> XMLType xmlForPopup = xml;<br />            btn.addActionListener(<span style="color:#7f0055;">new</span> ActionListener() {<br />                <span style="color:#7f0055;">public</span> <span style="color:#7f0055;">void</span> actionPerformed(ActionEvent ae) {<br />                    <span style="color:#3f7f5f;">// create editor pane</span><br />                    BasicEditorPane codeArea = EditorFactory.createIdeEditorPane();<br />                    <span style="color:#3f7f5f;">// Force the editor to highlight with xml</span><br />                    codeArea.setDocument(<span style="color:#7f0055;">new</span> BasicDocument(<span style="color:#2a00ff;">"foo.xml"</span>)); <span style="color:#3f7f5f;">// NORES</span><br />                    <span style="color:#3f7f5f;">// Add a line highlight plugin to highlight the caret</span><br />                    <span style="color:#3f7f5f;">// position line</span><br />                    <span style="color:#7f0055;">try</span> {<br />                        codeArea.setText(xmlForPopup.getStringVal());<br />                    }<br />                    <span style="color:#7f0055;">catch</span> (SQLException e) {<br />                        e.printStackTrace();<br />                    }<br />                    <span style="color:#3f7f5f;">// add the highlighter</span><br />                    codeArea.installPlugin(<span style="color:#7f0055;">new</span> LineHighlightPlugin());<br />                    <span style="color:#3f7f5f;">// non- editable</span><br />                    codeArea.setEditable(<span style="color:#7f0055;">false</span>);<br />                    <span style="color:#3f7f5f;">// add the gutter for line numbers</span><br />                    LineGutterPlugin sqlGutter = <span style="color:#7f0055;">new</span> LineGutterPlugin();<br />                    codeArea.installPlugin(sqlGutter);<br />                    <span style="color:#3f7f5f;">// put the editor into a scrollpane</span><br />                    JScrollPane sp = <span style="color:#7f0055;">new</span> JScrollPane(codeArea, JScrollPane.<span style="color:#0000c0;">VERTICAL_SCROLLBAR_AS_NEEDED</span>, JScrollPane.<span style="color:#0000c0;">HORIZONTAL_SCROLLBAR_AS_NEEDED</span>);<br />                    sp.setRowHeaderView(sqlGutter);<br />                    JPanel popupPanel = <span style="color:#7f0055;">new</span> JPanel(<span style="color:#7f0055;">new</span> BorderLayout());<br />                    popupPanel.add(sp, BorderLayout.<span style="color:#0000c0;">CENTER</span>);<br />                    popupPanel.setPreferredSize(<span style="color:#7f0055;">new</span> Dimension(200, 200));<br />                    <span style="color:#3f7f5f;">// helper class to show the panel int a popup</span><br />                    UIUtils.showPanelAsDialog(popupPanel, <span style="color:#2a00ff;">"XML Data"</span>, <span style="color:#7f0055;">null</span>, JEWTDialog.<span style="color:#0000c0;">BUTTON_CLOSE</span>);<br />                    <span style="color:#3f7f5f;">// grab the focus back to the table so &lt;TAB&gt; keeps working</span><br />                    table.requestFocusInWindow();<br />                }<br />            });<br />        }<br />        <span style="color:#7f0055;">catch</span> (SQLException e) {<br />            <span style="color:#3f7f5f;">// Guess we didn't care if and exception was thrown</span><br />            <span style="color:#3f7f5f;">// so return null so the next one can try and render</span><br />            <span style="color:#7f0055;">return</span> <span style="color:#7f0055;">null</span>;<br />        }<br />        <span style="color:#7f0055;">return</span> pnl;<br />    }<br />    <span style="color:#7f0055;">public</span> String getText(JTable table, Object value, <span style="color:#7f0055;">int</span> row, <span style="color:#7f0055;">int</span> column) {<br />        <span style="color:#7f0055;">return</span> <span style="color:#7f0055;">null</span>;<br />    }<br /><br /></pre><p><br />Here's another screen shot of an implementation for a cursor<br /></p><p><br /><img src="http://www.orablogs.com/krice/cursor.jpg"/><br /></p><p><br />Hopefully this is easy enough so that anyone can create renders for datatype which have not made it yet.<br /></p><p style="text-align:right;"><br /><span style="font-size:10pt;">[posted with </span><span style="font-size:10pt;"><a href="http://ecto.kung-foo.tv">ecto</a></span><span style="font-size:10pt;">]</span><br /></p>